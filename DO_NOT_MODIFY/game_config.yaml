# =============================================================================
# Suika Competition - Game Configuration
# =============================================================================
# This file contains ALL tunable parameters for the competition.
# DO NOT MODIFY during competition - these values are locked.
# =============================================================================

# -----------------------------------------------------------------------------
# Board Configuration
# -----------------------------------------------------------------------------
board:
  # Arena sized to match original Suika Game
  # Two watermelons (189px radius = 378px diameter) can barely fit side-by-side
  # Arena can hold ~350 cherries when perfectly packed (physics limits to much less)
  width: 800               # Fits 2 watermelons (378×2=756) with small margin
  height: 1000             # Narrow and tall like original Suika
  
  # Lose line: fruits above this for >1s = game over
  lose_line_y: 900         # Y coordinate of lose line (90% up)
  lose_line_grace_time: 1.0  # Seconds before game over triggers
  
  # Spawn position
  spawn_y: 950             # Y coordinate where fruits spawn
  spawn_margin: 5          # Extra margin from walls (pixels)

# -----------------------------------------------------------------------------
# Physics Configuration
# -----------------------------------------------------------------------------
physics:
  gravity_x: 0             # Horizontal gravity (m/s^2)
  gravity_y: -980          # Vertical gravity (m/s^2), negative = down
  damping: 0.98            # Global velocity damping per step
  
  # Time stepping
  dt: 0.008333333          # Physics timestep (1/120 second)
  substeps: 1              # Substeps per tick
  
  # Settle detection
  settle_velocity_threshold: 2.0      # Max linear velocity to be "settled" (px/s)
  settle_angular_threshold: 0.5       # Max angular velocity to be "settled" (rad/s)
  settle_consecutive_ticks: 15        # Consecutive ticks below threshold
  
  # Safety limits
  max_sim_seconds_per_drop: 8.0       # Hard cap before force-freeze (increased)
  merge_resets_timer: true            # Reset settle timer when merge happens
  
  # Wall/floor friction (moderate for stable stacking)
  default_friction: 0.5
  default_elasticity: 0.3

# -----------------------------------------------------------------------------
# Fruit Ladder Definition
# -----------------------------------------------------------------------------
# 11 fruit types from Cherry (smallest) to Watermelon (largest)
# Merging two fruits of type N produces one fruit of type N+1
# Merging two Watermelons removes both and awards bonus points
# 
# SCORING (matches original Suika game):
#   Cherry:1, Strawberry:3, Grape:6, Dekopon:10, Persimmon:15,
#   Apple:21, Pear:28, Peach:36, Pineapple:45, Melon:55, Watermelon:66
# -----------------------------------------------------------------------------
fruits:
  # ---- Level 0: Cherry ----
  - id: 0
    name: cherry
    mass: 0.5
    visual_radius: 15
    collision_circles:
      - [15, 0, 0]        # Original Suika size
    merge_score: 1
    friction: 0.3
    elasticity: 0.5
    color_solid: [220, 20, 60]
    color_full: [220, 20, 60]

  # ---- Level 1: Strawberry ----
  - id: 1
    name: strawberry
    mass: 1.0
    visual_radius: 21
    collision_circles:
      - [21, 0, 0]        # Original Suika size
    merge_score: 3
    friction: 0.3
    elasticity: 0.5
    color_solid: [255, 99, 71]
    color_full: [255, 99, 71]

  # ---- Level 2: Grape (composite for cluster shape) ----
  - id: 2
    name: grape
    mass: 2.5
    visual_radius: 31
    collision_circles:
      - [16, 0, 7]        # Top center
      - [14, -9, -5]      # Bottom left
      - [14, 9, -5]       # Bottom right
    merge_score: 6
    friction: 0.35
    elasticity: 0.45
    color_solid: [128, 0, 128]
    color_full: [138, 43, 226]

  # ---- Level 3: Dekopon (Mandarin) ----
  - id: 3
    name: dekopon
    mass: 4.5
    visual_radius: 39
    collision_circles:
      - [39, 0, 0]        # Original Suika size
    merge_score: 10
    friction: 0.3
    elasticity: 0.45
    color_solid: [255, 165, 0]
    color_full: [255, 140, 0]

  # ---- Level 4: Persimmon ----
  - id: 4
    name: persimmon
    mass: 8.0
    visual_radius: 49
    collision_circles:
      - [49, 0, 0]        # Original Suika size
    merge_score: 15
    friction: 0.3
    elasticity: 0.4
    color_solid: [255, 127, 80]
    color_full: [255, 99, 71]

  # ---- Level 5: Apple ----
  - id: 5
    name: apple
    mass: 14.0
    visual_radius: 62
    collision_circles:
      - [62, 0, 0]        # Original Suika size
    merge_score: 21
    friction: 0.3
    elasticity: 0.35
    color_solid: [255, 0, 0]
    color_full: [178, 34, 34]

  # ---- Level 6: Pear (pear-shaped composite) ----
  - id: 6
    name: pear
    mass: 24.0
    visual_radius: 77
    collision_circles:
      - [52, 0, -12]      # Bottom bulge
      - [38, 0, 28]       # Top narrow
    merge_score: 28
    friction: 0.35
    elasticity: 0.3
    color_solid: [154, 205, 50]
    color_full: [173, 255, 47]

  # ---- Level 7: Peach ----
  - id: 7
    name: peach
    mass: 38.0
    visual_radius: 97
    collision_circles:
      - [97, 0, 0]        # Original Suika size
    merge_score: 36
    friction: 0.35
    elasticity: 0.28
    color_solid: [255, 150, 180]
    color_full: [255, 130, 160]

  # ---- Level 8: Pineapple (tall composite) ----
  - id: 8
    name: pineapple
    mass: 60.0
    visual_radius: 121
    collision_circles:
      - [72, 0, -20]      # Body (lower, wider)
      - [55, 0, 50]       # Crown area (upper)
    merge_score: 45
    friction: 0.4
    elasticity: 0.25
    color_solid: [255, 215, 0]
    color_full: [218, 165, 32]

  # ---- Level 9: Melon (Honeydew) ----
  - id: 9
    name: melon
    mass: 90.0
    visual_radius: 151
    collision_circles:
      - [151, 0, 0]       # Original Suika size
    merge_score: 55
    friction: 0.35
    elasticity: 0.22
    color_solid: [127, 255, 0]
    color_full: [144, 238, 144]

  # ---- Level 10: Watermelon (largest - two watermelons destroy each other) ----
  - id: 10
    name: watermelon
    mass: 130.0
    visual_radius: 189
    collision_circles:
      - [189, 0, 0]       # Original Suika size
    merge_score: 66
    friction: 0.4
    elasticity: 0.18
    color_solid: [34, 139, 34]
    color_full: [50, 205, 50]

# -----------------------------------------------------------------------------
# Merge Configuration
# -----------------------------------------------------------------------------
merge:
  # Impulse applied to newly merged fruit (collision-reactive "pop")
  impulse_upward: 280.0    # Base upward impulse magnitude
  impulse_variance: 10.0   # Random variance in impulse
  radial_impulse: 180.0    # Radial impulse to nearby fruits

# -----------------------------------------------------------------------------
# RNG / Spawn Queue Configuration
# -----------------------------------------------------------------------------
rng:
  spawnable_count: 5       # Only fruits 0-4 can be spawned directly
  bag_size: 25             # Items per shuffle bag
  
  # Weights for each spawnable fruit (must have spawnable_count entries)
  # Higher weight = more frequent
  weights: [6, 6, 6, 4, 3]  # Cherry, Strawberry, Grape, Dekopon, Persimmon

# -----------------------------------------------------------------------------
# Scoring Configuration
# -----------------------------------------------------------------------------
scoring:
  # Bonus for merging two melons (both disappear)
  melon_melon_bonus: 50
  
  # Per-fruit merge scores are defined in the fruits section above

# -----------------------------------------------------------------------------
# Game Caps
# -----------------------------------------------------------------------------
caps:
  max_drops: 10000         # Maximum fruits that can be dropped per episode
  max_objects: 200         # Maximum simultaneous fruits (safety limit)
  # max_score: null        # Optional score cap (disabled)

# -----------------------------------------------------------------------------
# Domain Randomization
# -----------------------------------------------------------------------------
# Applied at episode start for robustness training.
# AI agents do not see these values - only the effects.
# Same seed = same randomization for fair evaluation.
domain_randomization:
  enabled: true
  friction_variance: 0.02     # ±2% variation
  elasticity_variance: 0.02   # ±2% variation
  mass_variance: 0.04         # ±4% per fruit
  gravity_variance: 0.01      # ±1% variation

# -----------------------------------------------------------------------------
# Observation Configuration
# -----------------------------------------------------------------------------
observation:
  max_objects: 200         # Padded array size for object observations
  include_angular: true    # Include angular position/velocity in obs
  
  # Image observation settings (scaled to half board size for efficiency)
  image_enabled: false     # Set to true to include board_rgb in obs
  image_width: 400         # Width of rendered image (half board width: 800/2)
  image_height: 500        # Height of rendered image (half board height: 1000/2)
  render_style: "full"     # "solid" for blobs, "full" for sprites

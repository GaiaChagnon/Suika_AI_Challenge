# =============================================================================
# Suika Competition - Game Configuration
# =============================================================================
# This file contains ALL tunable parameters for the competition.
# DO NOT MODIFY during competition - these values are locked.
# =============================================================================

# -----------------------------------------------------------------------------
# Board Configuration
# -----------------------------------------------------------------------------
board:
  # Arena: 400 x 500 (4:5 aspect ratio)
  width: 440               # Arena width
  height: 550              # Arena height
  
  # Lose line: fruits above this for >3s = game over
  lose_line_y: 475         # 95% of arena height
  lose_line_grace_time: 3.0  # Seconds before game over triggers
  
  # Spawn position
  spawn_y: 485             # Y coordinate where fruits spawn
  spawn_margin: 3          # Extra margin from walls (pixels)

# -----------------------------------------------------------------------------
# Physics Configuration
# -----------------------------------------------------------------------------
physics:
  gravity_x: 0             # Horizontal gravity (m/s^2)
  gravity_y: -980          # Vertical gravity (m/s^2), negative = down
  damping: 0.98            # Global velocity damping per step
  
  # Time stepping
  dt: 0.008333333          # Physics timestep (1/120 second)
  substeps: 1              # Substeps per tick
  
  # Settle detection
  settle_velocity_threshold: 2.0      # Max linear velocity to be "settled" (px/s)
  settle_angular_threshold: 0.5       # Max angular velocity to be "settled" (rad/s)
  settle_consecutive_ticks: 15        # Consecutive ticks below threshold
  
  # Safety limits
  max_sim_seconds_per_drop: 8.0       # Hard cap before force-freeze (increased)
  merge_resets_timer: true            # Reset settle timer when merge happens
  
  # Wall/floor friction (lower for smoother sliding)
  default_friction: 0.6
  default_elasticity: 0.3

# -----------------------------------------------------------------------------
# Fruit Ladder Definition
# -----------------------------------------------------------------------------
# 11 fruit types from Cherry (smallest) to Watermelon (largest)
# Merging two fruits of type N produces one fruit of type N+1
# Merging two Watermelons removes both and awards bonus points
# 
# SCORING (matches original Suika game):
#   Cherry:1, Strawberry:3, Grape:6, Dekopon:10, Persimmon:15,
#   Apple:21, Pear:28, Peach:36, Pineapple:45, Banana:55, Watermelon:66, Skull:100
# -----------------------------------------------------------------------------
fruits:
  # ==========================================================================
  # Fruit sizes based on user specifications
  # Arena: 400 x 500, Watermelon = 230px diameter (57.5% of width)
  # Two watermelons fit diagonally with 90px margin
  # ==========================================================================
  
  # ---- Level 0: Cherry (28px diameter) ----
  - id: 0
    name: cherry
    mass: 1.0
    visual_radius: 14
    collision_circles:
      - [14, 0, 0]
    merge_score: 1
    friction: 0.15
    elasticity: 0.5
    color_solid: [220, 20, 60]
    color_full: [220, 20, 60]

  # ---- Level 1: Strawberry (38px diameter) ----
  - id: 1
    name: strawberry
    mass: 2.0
    visual_radius: 19
    collision_circles:
      - [19, 0, 0]
    merge_score: 3
    friction: 0.2
    elasticity: 0.4
    color_solid: [255, 99, 71]
    color_full: [255, 99, 71]

  # ---- Level 2: Grape (58px diameter) ----
  - id: 2
    name: grape
    mass: 4.0
    visual_radius: 29
    collision_circles:
      - [16, 0, 6]        # Top center
      - [14, -10, -5]     # Bottom left
      - [14, 10, -5]      # Bottom right
    merge_score: 6
    friction: 0.3
    elasticity: 0.45
    color_solid: [128, 0, 128]
    color_full: [138, 43, 226]

  # ---- Level 3: Dekopon (67px diameter) ----
  - id: 3
    name: dekopon
    mass: 6.0
    visual_radius: 34
    collision_circles:
      - [34, 0, 0]
    merge_score: 10
    friction: 0.2
    elasticity: 0.45
    color_solid: [255, 165, 0]
    color_full: [255, 140, 0]

  # ---- Level 4: Persimmon (77px diameter) ----
  - id: 4
    name: persimmon
    mass: 10.0
    visual_radius: 39
    collision_circles:
      - [39, 0, 0]
    merge_score: 15
    friction: 0.2
    elasticity: 0.4
    color_solid: [255, 127, 80]
    color_full: [255, 99, 71]

  # ---- Level 5: Apple (94px diameter) ----
  - id: 5
    name: apple
    mass: 16.0
    visual_radius: 47
    collision_circles:
      - [47, 0, 0]
    merge_score: 21
    friction: 0.2
    elasticity: 0.35
    color_solid: [255, 0, 0]
    color_full: [178, 34, 34]

  # ---- Level 6: Pear (115px diameter) ----
  - id: 6
    name: pear
    mass: 24.0
    visual_radius: 58
    collision_circles:
      - [39, 0, -10]      # Bottom bulge
      - [29, 0, 22]       # Top narrow
    merge_score: 28
    friction: 0.2
    elasticity: 0.3
    color_solid: [154, 205, 50]
    color_full: [173, 255, 47]

  # ---- Level 7: Peach (140px diameter) ----
  - id: 7
    name: peach
    mass: 35.0
    visual_radius: 70
    collision_circles:
      - [70, 0, 0]
    merge_score: 36
    friction: 0.2
    elasticity: 0.28
    color_solid: [255, 150, 180]
    color_full: [255, 130, 160]

  # ---- Level 8: Pineapple (165px diameter) ----
  - id: 8
    name: pineapple
    mass: 50.0
    visual_radius: 83
    collision_circles:
      - [50, 0, -14]      # Body (lower, wider)
      - [37, 0, 33]       # Crown area (upper)
    merge_score: 45
    friction: 0.2
    elasticity: 0.25
    color_solid: [255, 215, 0]
    color_full: [218, 165, 32]

  # ---- Level 9: Banana (195px diameter) ----
  - id: 9
    name: banana
    mass: 75.0
    visual_radius: 98
    collision_circles:
      - [98, 0, 0]
    merge_score: 55
    friction: 0.2
    elasticity: 0.22
    color_solid: [255, 230, 100]
    color_full: [255, 220, 80]

  # ---- Level 10: Watermelon (230px diameter) ----
  - id: 10
    name: watermelon
    mass: 100.0
    visual_radius: 115
    collision_circles:
      - [115, 0, 0]
    merge_score: 66
    friction: 0.2
    elasticity: 0.18
    color_solid: [34, 139, 34]
    color_full: [50, 205, 50]

  # ---- Level 11: Skull (67px diameter, same as Dekopon) ----
  # Two watermelons merge into a skull. Skulls cannot merge with anything.
  # Each skull on board multiplies all future points by 1.5x (2 skulls = 2x, etc.)
  - id: 11
    name: skull
    mass: 30.0
    visual_radius: 34
    collision_circles:
      - [34, 0, 0]
    merge_score: 100      # Bonus for creating a skull
    friction: 0.2
    elasticity: 0.15
    color_solid: [60, 60, 60]
    color_full: [40, 40, 40]
    is_final: true        # Cannot merge with anything

# -----------------------------------------------------------------------------
# Merge Configuration
# -----------------------------------------------------------------------------
merge:
  # Impulse applied to newly merged fruit (collision-reactive "pop")
  # Reduced to prevent fruits from flying off the small arena
  impulse_upward: 150.0     # Base upward impulse magnitude (reduced for small arena)
  impulse_variance: 5.0    # Random variance in impulse
  radial_impulse: 250.0     # Radial impulse to nearby fruits (reduced for stability)

# -----------------------------------------------------------------------------
# RNG / Spawn Queue Configuration
# -----------------------------------------------------------------------------
rng:
  spawnable_count: 5       # Only fruits 0-4 can be spawned directly
  bag_size: 25             # Items per shuffle bag
  
  # Weights for each spawnable fruit (must have spawnable_count entries)
  # Higher weight = more frequent
  weights: [6, 6, 6, 4, 3]  # Cherry, Strawberry, Grape, Dekopon, Persimmon

# -----------------------------------------------------------------------------
# Scoring Configuration
# -----------------------------------------------------------------------------
scoring:
  # Bonus for merging two melons (both disappear)
  melon_melon_bonus: 0
  
  # Per-fruit merge scores are defined in the fruits section above

# -----------------------------------------------------------------------------
# Game Caps
# -----------------------------------------------------------------------------
caps:
  max_drops: 10000         # Maximum fruits that can be dropped per episode
  max_objects: 200         # Maximum simultaneous fruits (safety limit)
  # max_score: null        # Optional score cap (disabled)
  
  # Out-of-bounds termination: If any fruit goes further than this distance
  # beyond the board edges, the game terminates immediately.
  # This catches runaway fruits from physics glitches (e.g., fruits ejected
  # by merge impulses that fly off and never return).
  out_of_bounds_distance: 300  # Pixels beyond board edge before termination

# -----------------------------------------------------------------------------
# Domain Randomization
# -----------------------------------------------------------------------------
# Applied at episode start for robustness training.
# AI agents do not see these values - only the effects.
# Same seed = same randomization for fair evaluation.
domain_randomization:
  enabled: true
  friction_variance: 0.02     # ±2% variation
  elasticity_variance: 0.02   # ±2% variation
  mass_variance: 0.04         # ±4% per fruit
  gravity_variance: 0.01      # ±1% variation

# -----------------------------------------------------------------------------
# Observation Configuration
# -----------------------------------------------------------------------------
observation:
  max_objects: 200         # Padded array size for object observations
  include_angular: true    # Include angular position/velocity in obs
  
  # Image observation settings (half board size for efficiency)
  image_enabled: false     # Set to true to include board_rgb in obs
  image_width: 200         # Width of rendered image (half board width: 400/2)
  image_height: 250        # Height of rendered image (half board height: 500/2)
  render_style: "full"     # "solid" for blobs, "full" for sprites
